{% extends 'includes/layout.html' %}
{% load i18n l10n shipments %}
{% block criarshipment %}active{% endblock %}

{% block specific_styles %}
<link href="/static/css/inlines.css" rel="stylesheet">
{% endblock %}

{% block specific_scripts %}
<script src="/static/js/specifics/shipment.js"></script>
{% endblock %}

{% block conteudo %}

    <div class="container-fluid">
      <div class="row">
        {% if user|has_shipment_perm:'add_shipment' %}
        <div class="col-md-1 sidebar">

        </div>
        <div class="col-md-10 main">
          <h1 class="page-header"><i class="fa fa-archive"></i> {% trans "Criar" %} {{ title }}</h1>
           {% if user|has_shipment_perm:'add_product' %}
           <div class="row">
            <div class="form-group">
                <div class="col-md-5">
                    <label>{% trans "Adicionar mais produtos a este shipment" %}:</label>
                    {% trans "Digite o nome do Produto" as new_product %}
                    <input type="text" name="{{ product_formset.prefix }}-autocomplete" placeholder="{{ new_product }}..." class="form-control" id="{{ product_formset.prefix }}-autocomplete" />
                    <input type="hidden" name="{{ product_formset.prefix }}-autocomplete-selected" id="{{ product_formset.prefix }}-autocomplete-selected" />
                </div>
                <div class="col-md-3">
                    <a class="btn btn-primary filtar-btn add-row" title="{{ product_formset.addText }}" href="javascript:void(0);"><i class="fa fa-fw fa-plus-square"></i> {{ product_formset.addText }}</a>
                </div>
            </div>
          </div>
          <br>
          {% endif %}
          <br>
        <form action="" method="post" id="form-save-shipment" enctype="multipart/form-data">
          {% csrf_token %}
            <input type="hidden" name="save_shipment" value="1">
            {{ shipment_formset.management_form }}
            {{ product_formset.management_form }}
          <div class="table-responsive">
            <table class="table table-striped js-inline-admin-formset" id="{{ product_formset.prefix }}-group"
               data-inline-type="stacked"
               data-inline-autocomplete="/product/autocomplete"
               data-inline-formset="{{ product_formset.inline_formset_data }}">
              <thead>
                <tr>
                  <th>{% trans "ID" %}</th>
                  <th>{% trans "Nome" %}</th>
                  <th>{% trans "Descrição" %}</th>
                  <th class="center">{% trans "Quantidade" %}</th>
                  {% if user|has_shipment_perm:'delete_product' %}
                  <th>{% trans "Retirar" %}</th>
                  {% endif %}
                </tr>
              </thead>
              <tbody>
              {% for product_form in product_formset %}
                <tr class="inline-related {% if forloop.last %}empty-form{% endif %}"
                  id="{{ product_formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}">
                  {{ product_form.product|safe }}
                  <td class="center">
                      <input type="number" class="form-control menor-m quantity_validate add-validate-rule" id="{{ product_form.quantity.id_for_label }}" name="{{ product_form.quantity.html_name }}" value="{% if product_form.quantity.value %}{{ product_form.quantity.value|unlocalize }}{% endif %}" />
                      {% for error in product_form.quantity.errors %}
                        <label id="{{ product_form.quantity.id_for_label }}-error" class="error" for="{{ product_form.quantity.id_for_label }}">{{ error|escape }}</label>
                      {% endfor %}
                      {{ product_form.id }}
                      {{ product_form.shipment }}
                  </td>
                  {% if user|has_shipment_perm:'delete_product' %}
                  <td>
                      {% if product_formset.can_delete %}
                      <a class="btn btn-danger inline-deletelink" title="{{ product_formset.deleteText }}" href="#"><i class="fa fa-fw fa-close"></i></a>
                      {% endif %}
                  </td>
                  {% endif %}
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div> <hr />
          {% for shipment_form in shipment_formset %}
            {{ shipment_form.id }}
          <div class="row">
            <div class="col-md-4">
                <label><i class="fa fa-fw fa-bar-chart"></i> {% trans "Valores" %}:</label><br><br>
                <a class="btn btn-default" href="#" id="btn-calculate-shipment"><i class="fa fa-fw fa-calculator"></i> {% trans "Calcular valor do Envio" %}</a><br><br>
                <p><strong><i class="fa fa-fw fa-list-ol"></i> {% trans "Total de Produtos" %}: </strong><span id="totalProducts">-</span> </p>
                <p><strong><i class="fa fa-fw fa-money"></i> {% trans "Valor Total" %}: </strong> U$ <span id="totalCost">-</span></p>
            </div>
            <div class="col-md-4">
                <p><strong><i class="fa fa-fw fa-calendar"></i> {{ shipment_form.send_date.label }}: </strong></p>
                <div class="form-group">
                    {% with formatted_date=shipment_form.send_date.value|date:'SHORT_DATE_FORMAT' %}
                    <input type="text" placeholder="{{ shipment_form.send_date.label }}..." name="{{ shipment_form.send_date.html_name }}" class="form-control menor datepicker send_date_validate" id="{{ shipment_form.send_date.id_for_label }}" value="{% if formatted_date %}{{ formatted_date }}{% elif shipment_form.send_date.value %}{{ shipment_form.send_date.value }}{% endif %}">
                    {% endwith %}
                      {% for error in shipment_form.send_date.errors %}
                        <label id="{{ shipment_form.send_date.id_for_label }}-error" class="error" for="{{ shipment_form.send_date.id_for_label }}">{{ error|escape }}</label>
                      {% endfor %}
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label><i class="fa fa-fw fa-file-pdf-o"></i> {% trans "Download PDFs" %}:</label><br><br>
                    <label>{{ shipment_form.pdf_1.label }}:</label>{{ shipment_form.pdf_1 }}
                      {% for error in shipment_form.pdf_1.errors %}
                        <label id="{{ shipment_form.pdf_1.id_for_label }}-error" class="error" for="{{ shipment_form.pdf_1.id_for_label }}">{{ error|escape }}</label>
                      {% endfor %}
                    <br>
                    <label>{{ shipment_form.pdf_2.label }}:</label><br><p>{% trans "Upload não autorizado" %}</p>
                </div>
            </div>
          </div>
          {% endfor %}
            <hr />
           <div class="row">
            <button class="btn btn-primary filtar-btn alterar-status" id="send-btn" type="submit"><i class="fa fa-fw fa-paper-plane"></i> Salvar</button><br><br><!--
            <a class="btn btn-primary filtar-btn" href="#"><i class="fa fa-fw fa-paypal"></i> Salvar e efetuar Pagamento Agora</a><br>--><a href="javascript:history.back()"><i class="fa fa-fw fa-long-arrow-left"></i> Voltar</a><br><br><br><br>
           </div>
        </form>
          </div>
          {% endif %}
        </div>
        <div class="col-md-1 sidebar">
        </div>
      </div>
    </div>

{% endblock %}
